package mapping_definer

import (
	"log"
	"testing"

	"github.com/tidwall/gjson"
)

// func TestRecommendMapping(t *testing.T) {

// 	mapping := `{"mappings":{"dynamic":"false","_source":{"excludes":["currency_id","cluster_id","gender","keyword","name_sort","phash_info","status","warehouse.zip_code"]},"properties":{"annotation_id":{"type":"keyword"},"bestmatch_score_controller":{"type":"scaled_float","scaling_factor":100000.0},"bestmatch_score_controller2":{"type":"scaled_float","scaling_factor":100000.0},"bestmatch_score_controller3":{"type":"scaled_float","scaling_factor":100000.0},"bestmatch_score_default":{"type":"float"},"bestmatch_score_experiment":{"type":"scaled_float","scaling_factor":100000.0},"bestmatch_score_experiment2":{"type":"scaled_float","scaling_factor":100000.0},"bestmatch_score_experiment3":{"type":"scaled_float","scaling_factor":100000.0},"bestmatch_score_experiment4":{"type":"scaled_float","scaling_factor":100000.0},"bestmatch_score_experiment5":{"type":"scaled_float","scaling_factor":100000.0},"bestmatch_score_experiment6":{"type":"scaled_float","scaling_factor":100000.0},"bundle_id":{"type":"object","enabled":false},"bundle_ids":{"type":"object"},"bundleids":{"type":"keyword"},"campaign_thematic":{"properties":{"boost":{"type":"boolean","index":false},"id":{"type":"keyword"},"label":{"type":"text","index":false},"label_bg":{"type":"text","index":false},"type_id":{"type":"keyword"}}},"campaign_type_id":{"type":"keyword","doc_values":false},"cashback_amount":{"type":"byte"},"catalog_id":{"type":"keyword"},"cheap_cluster":{"type":"keyword","doc_values":false},"child_category_id":{"type":"keyword"},"child_ids":{"type":"keyword"},"city_affinities":{"type":"keyword","doc_values":false},"city_id":{"type":"keyword"},"city_name":{"type":"object","enabled":false},"cluster_id_v2":{"type":"keyword"},"condition":{"type":"keyword"},"count_review":{"type":"integer"},"count_sold":{"type":"integer"},"count_talk":{"type":"integer"},"count_transaction":{"type":"integer"},"count_view":{"type":"integer"},"create_time":{"type":"date"},"customvideo_url":{"type":"object","enabled":false},"default_child_id":{"type":"keyword"},"department_id":{"type":"keyword"},"disco_page_id":{"type":"keyword"},"discount_expired_time":{"type":"date"},"discount_percentage":{"type":"byte"},"discount_start_time":{"type":"date"},"discounted_price":{"type":"long"},"extended_name":{"type":"text","fields":{"advance_search":{"type":"text","analyzer":"advance_search_analyzer"}}},"flag":{"type":"keyword"},"free_cluster":{"type":"keyword","doc_values":false},"has_cashback":{"type":"boolean"},"has_discount":{"type":"boolean"},"hot_curated":{"type":"integer"},"hot_featured":{"type":"integer"},"hot_product_order":{"type":"integer"},"hotlist_id":{"type":"keyword"},"id":{"type":"long"},"image_name":{"type":"object","enabled":false},"image_name_catalog":{"type":"object","enabled":false},"image_path":{"type":"object","enabled":false},"image_path_catalog":{"type":"object","enabled":false},"is_adult":{"type":"boolean"},"is_bebas_ongkir_promo":{"type":"boolean"},"is_cod":{"type":"boolean"},"is_customvideo":{"type":"boolean"},"is_fulfillment":{"type":"boolean"},"is_ico":{"type":"boolean"},"is_kreasi_lokal":{"type":"boolean"},"is_plus":{"type":"boolean"},"is_preorder":{"type":"boolean"},"is_topads":{"type":"boolean"},"is_trending":{"type":"boolean"},"keyword_type":{"type":"keyword"},"location":{"type":"keyword"},"max_order":{"type":"object","enabled":false},"max_price":{"type":"long"},"menu_id":{"type":"keyword"},"min_order":{"type":"long"},"min_price":{"type":"long"},"mvc_amount":{"type":"object","enabled":false},"mvc_budget":{"type":"keyword","doc_values":false},"mvc_type":{"type":"keyword"},"mvc_voucher":{"type":"keyword"},"name":{"type":"text","copy_to":["name_ngram","name_graph"]},"name_graph":{"type":"text","analyzer":"keyword_delimiter_graph_analyzer"},"name_ngram":{"type":"text","analyzer":"keyword_ngram_analyzer","search_analyzer":"standard"},"near_districts":{"type":"keyword","doc_values":false},"nearby_districts":{"type":"keyword","doc_values":false},"nearer_districts":{"type":"keyword","doc_values":false},"original_price":{"type":"integer"},"pacman_time_unix":{"type":"long"},"parent_id":{"type":"keyword"},"portrait":{"type":"object","enabled":false},"position":{"type":"integer"},"preorder_time":{"type":"object","enabled":false},"prescribed":{"type":"object","enabled":false},"price":{"type":"integer"},"price_level":{"type":"short"},"product_score":{"type":"short"},"rating":{"type":"object","enabled":false},"refined_name":{"type":"text"},"review_score":{"type":"scaled_float","scaling_factor":100000.0},"search_target":{"type":"keyword","doc_values":false},"shipping":{"type":"keyword"},"shipping_child":{"type":"keyword"},"shop":{"properties":{"commitment":{"type":"boolean"},"domain":{"type":"keyword"},"geo_location":{"type":"geo_point"},"gold_merchant_expired":{"type":"date"},"id":{"type":"keyword"},"is_official":{"type":"boolean"},"is_power_badge":{"type":"boolean"},"is_power_merchant":{"type":"boolean"},"is_regular":{"type":"boolean"},"is_tokonow":{"type":"boolean"},"name":{"type":"keyword"},"rate_cancel":{"type":"scaled_float","scaling_factor":100.0},"shop_reputation":{"type":"long"},"shop_score":{"type":"short"},"shop_tier":{"type":"short"}}},"shop_id":{"type":"keyword"},"sku":{"type":"keyword","index":false,"copy_to":["sku_ngram"]},"sku_ngram":{"type":"text","analyzer":"keyword_ngram_analyzer"},"star_rating":{"type":"keyword"},"stock":{"type":"long"},"trade_in":{"type":"boolean"},"update_time":{"type":"date"},"url_path":{"type":"object","enabled":false},"variants":{"properties":{"colour":{"type":"keyword","index":false,"fields":{"keyword":{"type":"keyword","ignore_above":256}}},"size":{"type":"keyword","index":false,"fields":{"keyword":{"type":"keyword","ignore_above":256}}},"type":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}}}}},"variants_filter":{"type":"keyword"},"volume":{"type":"object","enabled":false},"vouchers":{"properties":{"cashback_percentage":{"type":"long"},"free_shipping":{"type":"boolean"}}},"warehouse":{"properties":{"city_id":{"type":"keyword"},"district":{"type":"object","enabled":false},"giftable":{"type":"boolean"},"is_default":{"type":"object","enabled":false},"latlng":{"type":"object","enabled":false},"location":{"type":"text"},"max_order":{"type":"object","enabled":false},"stock":{"type":"long","index":false},"warehouse_id":{"type":"keyword"}}},"weight":{"type":"object","enabled":false},"wholesale":{"properties":{"price":{"type":"integer"},"quantity_max":{"type":"short"},"quantity_min":{"type":"short"}}}}}}`

// 	k := optimization_engine.OptimizationSet{}
// 	opt := optimization_engine.Optimization{
// 		RemoveDocValues: true,
// 	}

// 	k["name"] = opt

// 	// RecommendMapping(mapping, k)
// }

func TestGetFullPath(t *testing.T) {
	mappingJson := `{"mappings":{"dynamic":"false","_source":{"excludes":["currency_id","cluster_id","gender","keyword","name_sort","phash_info","status","warehouse.zip_code"]},"properties":{"annotation_id":{"type":"keyword"},"bestmatch_score_controller":{"type":"scaled_float","scaling_factor":100000.0},"bestmatch_score_controller2":{"type":"scaled_float","scaling_factor":100000.0},"bestmatch_score_controller3":{"type":"scaled_float","scaling_factor":100000.0},"bestmatch_score_default":{"type":"float"},"bestmatch_score_experiment":{"type":"scaled_float","scaling_factor":100000.0},"bestmatch_score_experiment2":{"type":"scaled_float","scaling_factor":100000.0},"bestmatch_score_experiment3":{"type":"scaled_float","scaling_factor":100000.0},"bestmatch_score_experiment4":{"type":"scaled_float","scaling_factor":100000.0},"bestmatch_score_experiment5":{"type":"scaled_float","scaling_factor":100000.0},"bestmatch_score_experiment6":{"type":"scaled_float","scaling_factor":100000.0},"bundle_id":{"type":"object","enabled":false},"bundle_ids":{"type":"object"},"bundleids":{"type":"keyword"},"campaign_thematic":{"properties":{"boost":{"type":"boolean","index":false},"id":{"type":"keyword"},"label":{"type":"text","index":false},"label_bg":{"type":"text","index":false},"type_id":{"type":"keyword"}}},"campaign_type_id":{"type":"keyword","doc_values":false},"cashback_amount":{"type":"byte"},"catalog_id":{"type":"keyword"},"cheap_cluster":{"type":"keyword","doc_values":false},"child_category_id":{"type":"keyword"},"child_ids":{"type":"keyword"},"city_affinities":{"type":"keyword","doc_values":false},"city_id":{"type":"keyword"},"city_name":{"type":"object","enabled":false},"cluster_id_v2":{"type":"keyword"},"condition":{"type":"keyword"},"count_review":{"type":"integer"},"count_sold":{"type":"integer"},"count_talk":{"type":"integer"},"count_transaction":{"type":"integer"},"count_view":{"type":"integer"},"create_time":{"type":"date"},"customvideo_url":{"type":"object","enabled":false},"default_child_id":{"type":"keyword"},"department_id":{"type":"keyword"},"disco_page_id":{"type":"keyword"},"discount_expired_time":{"type":"date"},"discount_percentage":{"type":"byte"},"discount_start_time":{"type":"date"},"discounted_price":{"type":"long"},"extended_name":{"type":"text","fields":{"advance_search":{"type":"text","analyzer":"advance_search_analyzer"}}},"flag":{"type":"keyword"},"free_cluster":{"type":"keyword","doc_values":false},"has_cashback":{"type":"boolean"},"has_discount":{"type":"boolean"},"hot_curated":{"type":"integer"},"hot_featured":{"type":"integer"},"hot_product_order":{"type":"integer"},"hotlist_id":{"type":"keyword"},"id":{"type":"long"},"image_name":{"type":"object","enabled":false},"image_name_catalog":{"type":"object","enabled":false},"image_path":{"type":"object","enabled":false},"image_path_catalog":{"type":"object","enabled":false},"is_adult":{"type":"boolean"},"is_bebas_ongkir_promo":{"type":"boolean"},"is_cod":{"type":"boolean"},"is_customvideo":{"type":"boolean"},"is_fulfillment":{"type":"boolean"},"is_ico":{"type":"boolean"},"is_kreasi_lokal":{"type":"boolean"},"is_plus":{"type":"boolean"},"is_preorder":{"type":"boolean"},"is_topads":{"type":"boolean"},"is_trending":{"type":"boolean"},"keyword_type":{"type":"keyword"},"location":{"type":"keyword"},"max_order":{"type":"object","enabled":false},"max_price":{"type":"long"},"menu_id":{"type":"keyword"},"min_order":{"type":"long"},"min_price":{"type":"long"},"mvc_amount":{"type":"object","enabled":false},"mvc_budget":{"type":"keyword","doc_values":false},"mvc_type":{"type":"keyword"},"mvc_voucher":{"type":"keyword"},"name":{"type":"text","copy_to":["name_ngram","name_graph"]},"name_graph":{"type":"text","analyzer":"keyword_delimiter_graph_analyzer"},"name_ngram":{"type":"text","analyzer":"keyword_ngram_analyzer","search_analyzer":"standard"},"near_districts":{"type":"keyword","doc_values":false},"nearby_districts":{"type":"keyword","doc_values":false},"nearer_districts":{"type":"keyword","doc_values":false},"original_price":{"type":"integer"},"pacman_time_unix":{"type":"long"},"parent_id":{"type":"keyword"},"portrait":{"type":"object","enabled":false},"position":{"type":"integer"},"preorder_time":{"type":"object","enabled":false},"prescribed":{"type":"object","enabled":false},"price":{"type":"integer"},"price_level":{"type":"short"},"product_score":{"type":"short"},"rating":{"type":"object","enabled":false},"refined_name":{"type":"text"},"review_score":{"type":"scaled_float","scaling_factor":100000.0},"search_target":{"type":"keyword","doc_values":false},"shipping":{"type":"keyword"},"shipping_child":{"type":"keyword"},"shop":{"properties":{"commitment":{"type":"boolean"},"domain":{"type":"keyword"},"geo_location":{"type":"geo_point"},"gold_merchant_expired":{"type":"date"},"id":{"type":"keyword"},"is_official":{"type":"boolean"},"is_power_badge":{"type":"boolean"},"is_power_merchant":{"type":"boolean"},"is_regular":{"type":"boolean"},"is_tokonow":{"type":"boolean"},"name":{"type":"keyword"},"rate_cancel":{"type":"scaled_float","scaling_factor":100.0},"shop_reputation":{"type":"long"},"shop_score":{"type":"short"},"shop_tier":{"type":"short"}}},"shop_id":{"type":"keyword"},"sku":{"type":"keyword","index":false,"copy_to":["sku_ngram"]},"sku_ngram":{"type":"text","analyzer":"keyword_ngram_analyzer"},"star_rating":{"type":"keyword"},"stock":{"type":"long"},"trade_in":{"type":"boolean"},"update_time":{"type":"date"},"url_path":{"type":"object","enabled":false},"variants":{"properties":{"colour":{"type":"keyword","index":false,"fields":{"keyword":{"type":"keyword","ignore_above":256}}},"size":{"type":"keyword","index":false,"fields":{"keyword":{"type":"keyword","ignore_above":256}}},"type":{"type":"text","fields":{"keyword":{"type":"keyword","ignore_above":256}}}}},"variants_filter":{"type":"keyword"},"volume":{"type":"object","enabled":false},"vouchers":{"properties":{"cashback_percentage":{"type":"long"},"free_shipping":{"type":"boolean"}}},"warehouse":{"properties":{"city_id":{"type":"keyword"},"district":{"type":"object","enabled":false},"giftable":{"type":"boolean"},"is_default":{"type":"object","enabled":false},"latlng":{"type":"object","enabled":false},"location":{"type":"text"},"max_order":{"type":"object","enabled":false},"stock":{"type":"long","index":false},"warehouse_id":{"type":"keyword"}}},"weight":{"type":"object","enabled":false},"wholesale":{"properties":{"price":{"type":"integer"},"quantity_max":{"type":"short"},"quantity_min":{"type":"short"}}}}}}`

	a := GetFullPath(mappingJson, "extended_name.advance_search")

	r := gjson.Get(mappingJson, a)
	log.Print(r.Exists())

	log.Print(a)
}
